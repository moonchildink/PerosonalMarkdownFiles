# 嵌入式





## Chapter2 ARM微处理器概述与编程模型

### 基本概念

1. 精简指令集(RISC)与复杂指令集(CISC)，*非重点*

2. 哈佛结构与冯诺依曼结构

![image-20230412192533688](https://cdn.jsdelivr.net/gh/moonchildink/image@main/imgs/image-20230412192533688.png)

![image-20230412192551872](https://cdn.jsdelivr.net/gh/moonchildink/image@main/imgs/image-20230412192551872.png)

其中，这两种结构与指令系统并无绝对的关联。

3. CPU流水线（书上并无介绍）



### ARM处理器的运行模式

<img src="https://cdn.jsdelivr.net/gh/moonchildink/image@main/imgs/image-20230412193544024.png">

除用户模式意外，其他六种模式被称为特权模式。

在特权模式之中，程序可以访问所有系统资源；可以切换任意处理器模式。

在用户模式之中，应用程序无法访问被保护的系统资源，不能直接切换到其他模式。*但是可以通过制造异常，调用中断程序，来实现模式切换。*







### ARM处理器的工作状态

1. ARM微处理器的工作状态分以下两种

+ ARM状态：执行32位字对齐的ARM指令
+ Thumb状态：执行16位半字对其的Thumb指令

2. 状态切换

+ 当寄存器Rm的状态位`bit[0] = 1`时，可以通过执行`BX Rm`指令，使微处理器从ARM状态切换到Thumb状态。

```assembly
code32
ldr r0,=label+1		;地址的最低为1，表示切换到Thumb状态
bx r0

code16
label:
	mov r1,#12
```





### ARM处理器之中的寄存器

在ARM状态下，寄存器共有37个，而thumb状态下，寄存器有27个。

其中包括31个通用寄存器与6个32位状态寄存器。

其中，寄存器的分类如下：

1. 未分组寄存器：R0~R7，所有工作模式下通用
2. 分组寄存器：R8~R12，快速中断fiq模式一种，其他一种

![image-20230503213239883](https://cdn.jsdelivr.net/gh/moonchildink/image@main/imgs/image-20230503213239883.png)

3. 分组寄存器：R13与R14

![image-20230503213320986](https://cdn.jsdelivr.net/gh/moonchildink/image@main/imgs/image-20230503213320986.png)

在ARM指令集中，通常**使用R13作为堆栈指针，R14用于存放指令地址备份寄存器，R15作为程序计数器。**

**注意：**

1. 当产生中断嵌套时，由于会覆盖掉R14之中存放的程序返回地址，会导致无法正确返回终端调用程序。
2. 程序计数器PC，也就是R15，PC的数值，存放于高30位，而在Thumb状态下，存放于高31位。==其数值等于*当前指令指令地址+8*，因为ARM采用了多级流水线技术。==









## ARM指令集

**注意：**`{}`寄存器列表（reglist）必须按由小到大排列；无论出栈、入栈的方式如何，永远保持==低地址数据存放在小寄存器中，高地址数据存放在大寄存器之中==。